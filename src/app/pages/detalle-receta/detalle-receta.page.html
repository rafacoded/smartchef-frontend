<ion-header >
  <ion-toolbar class="sc-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Receta</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="abrirModalQR()">
        <ion-icon name="qr-code-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content>

  @if (receta) {

    <div class="sc-hero">
      <img [src]="receta.imagen" alt="Imagen de la receta" />

      <div class="sc-hero-overlay">
        <h1 class="sc-hero-title">{{ receta.titulo }}</h1>
      </div>
    </div>

    <div class="sc-page">

      <div class="sc-chips-row">
        <ion-chip [color]="getDificultadColor(receta.dificultad)">
          <ion-label>{{ receta.dificultad }}</ion-label>
        </ion-chip>

        <ion-chip class="chip-normal">
          <ion-label>{{ receta.categoria }}</ion-label>
        </ion-chip>

        <ion-chip class="chip-time">
          <ion-icon name="time-outline"></ion-icon>
          <ion-label>{{ receta.tiempoPreparacion }} min</ion-label>
        </ion-chip>
      </div>

      <section class="sc-section">
        <h2 class="sc-section-title">Descripción</h2>
        <p class="sc-text">{{ receta.descripcion }}</p>
      </section>

      <section class="sc-section">

        <div class="sc-section-header">
          <h2 class="sc-section-title">Ingredientes</h2>

          <ion-button
            fill="clear"
            class="btn-icon"
            slot="end">
            <ion-icon slot="icon-only" name="add-circle-outline"></ion-icon>
            <ion-icon slot="icon-only" name="cart-outline"></ion-icon>
          </ion-button>
        </div>

        <ion-list class="ingredients-list">
          @for (ing of ingredientesMock; track ing.id) {
            <ion-item lines="none">
              <ion-checkbox slot="start"></ion-checkbox>

              <ion-label>
                <h3>{{ ing.nombre }}</h3>
              </ion-label>

              <ion-note slot="end">
                {{ ing.cantidad }} {{ ing.unidad }}
              </ion-note>
            </ion-item>
          }
        </ion-list>

      </section>

      <section class="sc-section">
        <h2 class="sc-section-title">Preparación</h2>

        <ion-list [inset]="true">

          @for (paso of receta.pasos; track paso.orden) {
            <ion-item lines="full" class="step-item">

              <div class="step-number">{{ paso.orden }}</div>

              <div class="step-content">{{ paso.descripcion }}</div>

            </ion-item>
          }

        </ion-list>
      </section>


    </div>
  }

</ion-content>

<ion-modal [isOpen]="modalQrOpen" (didDismiss)="modalQrOpen = false">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>QR de la receta</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="modalQrOpen = false">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      @if (qrImgSrc) {
        <img [src]="qrImgSrc" style="width: 100%; max-width: 340px; display:block; margin: 0 auto;" />
        <p style="text-align:center; font-size: 12px; opacity:.7;">{{ qrData }}</p>
      } @else {
        <p>Generando QR...</p>
      }
    </ion-content>
  </ng-template>
</ion-modal>



